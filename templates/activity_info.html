{% extends "base.html" %}

{% load static %}

{% block mainpage %}

<!--  BEGIN CONTENT AREA  -->
<div id="content" class="main-content">

    {% if html_display.warn_code == 1 %}
    <div class="alert alert-warning  text-center">{{ html_display.warn_message }}</div>
    {% elif html_display.warn_code == 2 %}
    <div class="alert alert-success  text-center">{{ html_display.warn_message }}</div>
    {% endif %}

    <!--  BEGIN UPPER SECTION  -->
    <div class="d-flex m-0 p-0 overflow-hidden" id="bg">

        <!--  BEGIN BLURRED BG  -->
        {% if summary_photo_exists %}
        <div class="w-100" style="background-image: url({{ summary_photo }}); filter: blur(20px); -webkit-filter: blur(20px); background-position: center; background-repeat: no-repeat; background-size: cover;">
        {% else %}
        <div class="w-100" style="background-image: url({{ firstpic }}); filter: blur(20px); -webkit-filter: blur(20px); background-position: center; background-repeat: no-repeat; background-size: cover;">
        {% endif %}
            <div class="w-100 h-100 m-0 p-0">
                <div class="row w-100 m-0" style="height: 20%;"></div>
                <div class="row w-100 m-0" style="height: 30%; background: -webkit-linear-gradient(top, #ffffff00 0%, #ffffffaa 100%);"></div>
                <div class="row w-100 m-0" style="height: 50%; background-color: #ffffff;"></div>
            </div>
        </div>
        <!--  END BLURRED BG  -->

        <!--  BEGIN FRONT SCENE  -->
        <div style="position: absolute; width: 100%; height: 50vh; top: -8px;">  <!--  hide the top corner  -->
            <!--  BEGIN PHOTO  -->
            <div style="width: 66%; height: 80%; padding-left: 80px; padding-right: 80px; margin: auto;">
                {% if summary_photo_exists %}
                <img style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px; box-shadow: 1px 1px 16px 2px rgba(0, 0, 0, 0.12);" src={{ summary_photo }}></img>
                {% else %}
                <img style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px; box-shadow: 1px 1px 16px 2px rgba(0, 0, 0, 0.12);" src={{ firstpic }}></img>
                {% endif %}

                <!--  BEGIN CALENDAR  -->
                <div style="position: absolute; left: 17%; top: 80%;">
                    <div style="position: absolute; left: 0px; top: -70px; width: 70px; height: 70px; border-radius: 8px; overflow: hidden; box-shadow: 1px 1px 16px 2px rgba(0, 0, 0, 0.12);">
                        <!-- -------------------------------- MONTH -------------------------------- -->
                        <div class="d-flex" style="position: absolute; left: 0%; top: 0%; width: 100%; height: 30%; background-color: var(--danger)">
                            <div class="flex" style="width: 100%; margin: auto; text-align: center;">
                                <b class="text-light" style="font-size: 15px;">{{ start_month }}月</b>
                            </div>
                        </div>
                        <!-- --------------------------------- DAY --------------------------------- -->
                        <div class="d-flex" style="position: absolute; left: 0%; top: 30%; width: 100%; height: 70%; background-color: var(--white)">
                            <div class="flex" style="width: 100%; margin: auto; text-align: center;">
                                {% if start_date < 10 %}
                                <b class="text-dark" style="font-size: 30px;">{{ start_date }}日</b>
                                {% else %}
                                <b class="text-dark" style="font-size: 25px;">{{ start_date }}日</b>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <!--  END CALENDAR  -->

            </div>
            <!--  END PHOTO  -->

            <!--  BEGIN HEADING  -->
            <div style="width: 66%; height: max-content; margin: auto; margin-top: 10px;">
                <b class="text-danger">{{ activity.start }} - {{ activity.end }}</b>
                <div class="d-flex justify-content-start">
                    <h2 class="flex text-dark">{{ title }}</h2>
                    <div class="flex my-auto ml-1">
                        {% if status == "审核中" %}
                        <span class="badge badge-pill badge-warning">审核中</span>
                        {% elif status == "等待中" %}
                        <span class="badge badge-pill badge-info">等待中</span>
                        {% elif status == "已取消" or status == "已结束" %}
                        <span class="badge badge-pill badge-danger">{{ status }}</span>
                        {% else %}
                        <span class="badge badge-pill badge-success">{{ status }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!--  END HEADING  -->

            <!-- ------------------------------ div line ------------------------------- -->
            <div id="div-line" style="width: 69%; height: 2px; margin: auto; margin-top: 5px; background-color:rgba(0, 0, 0, 0.2)"></div>

            <!-- -------------------------- constrain height --------------------------- -->
            <script type="text/javascript">
                const bg = document.querySelector(`#bg`);
                const div = document.querySelector(`#div-line`);
                const fit = () =>  (bg.style.height = `${div.offsetTop - 7}px`);
                window.addEventListener(`load`, fit);
                window.addEventListener(`resize`, fit);
            </script>
        </div>
        <!--  END FRONT SCENE  -->

    </div>
    <!--  END UPPER SECTION  -->

    <div class="row m-0 mx-auto" style="width: 70%;">

        <div class="col-md-9 col-sm-12 px-1 layout-top-spacing">

            <!--  BEGIN ACTIVITY INFORMATION  -->
            <div class="container w-100 px-0">
                <div class="statbox widget box box-shadow">

                    <div class="widget-header">
                        <div class="row">
                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                <h4>详细信息</h4>
                            </div>
                        </div>
                    </div>

                    <div class="widget-content widget-content-area">

                        <!--  活动信息  -->
                        <div class="code-section-container show-code mt-0">

                            <div class="media-body">
                                <p class="meta-time">
                                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor"
                                        stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"
                                        class="css-i6dzq1">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <span class="ml-3">
                                        {{ duration }}
                                    </span>
                                </p>

                                <p class="meta-time">
                                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor"
                                        stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"
                                        class="css-i6dzq1">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <span class="ml-3">
                                        {{ activity.location }}
                                    </span>
                                </p>

                                <p class="meta-time">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M18.36 6.64a9 9 0 1 1-12.73 0" />
                                        <line x1="12" y1="2" x2="12" y2="12" />
                                    </svg>
                                    <span class="ml-3">
                                        {{ apply_deadline }}&nbsp;截止
                                    </span>
                                </p>

                                <p>
                                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor"
                                        stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"
                                        class="css-i6dzq1">
                                        <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
                                        <line x1="16" y1="8" x2="2" y2="22"></line>
                                        <line x1="17.5" y1="15" x2="9" y2="15"></line>
                                    </svg>
                                    <span class="ml-3">
                                        {{ apply_manner }}
                                    </span>
                                </p>

                                <p>
                                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="12" cy="12" r="10"></circle><rect x="9" y="9" width="6" height="6"></rect></svg>
                                    <span class="ml-3">
                                        {{ price }}&nbsp;元气值
                                    </span>
                                </p>

                                <p>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                        <circle cx="9" cy="7" r="4" />
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                    </svg>
                                    <span class="ml-3">
                                        {{ current_participants }} / {{ capacity }}&nbsp;报名
                                    </span>
                                </p>

                                {% if show_url == True %}
                                <p>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10" />
                                        <line x1="2" y1="12" x2="22" y2="12" />
                                        <path
                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                                    </svg>
                                    <span class="ml-3">
                                        <a href="{{aURL}}"><abbr title="link">跳转至活动链接</abbr></a>
                                    </span>
                                </p>
                                {% endif %}

                            </div>

                            <!--  按钮部分  -->
                            <div>

                                {% if examine %}
                                    {%if status == "审核中" or not activity.valid%}
                                    <button class="btn btn-primary btn-block mb-4 mr-2" data-toggle="collapse"
                                        data-target="#extend-area" onclick="location='/examineActivity/{{aid}}'">
                                        审批活动
                                    </button>
                                    {%elif activity.valid%}
                                    <button class="btn btn-primary btn-block mb-4 mr-2" data-toggle="collapse"
                                        data-target="#extend-area" disabled>
                                        已经审核
                                    </button>
                                    {% endif %}

                                {% endif %}

                                {% if person %}
                                <!-- ----------------------------------------------------------------------- -->
                                <!--                            begin person view                            -->
                                <!-- ----------------------------------------------------------------------- -->

                                {% if pStatus == "无记录" and status == "报名中" %}
                                <form method="POST">
                                    <input type="hidden" name="option" value="apply">
                                    <button class="btn btn-primary btn-block mb-4 mr-2">立即报名</button>
                                </form>

                                {% elif pStatus == "无记录" and status != "审核中" %}

                                <!-- ------------------------- begin check status -------------------------- -->
                                {% if status == "等待中" %}
                                <a href="javascript:void(0);" class="btn btn-danger btn-block mb-4 mr-2">报名截止</a>
                                {% endif %}

                                {% elif pStatus == "申请中" %}
                                <a href="javascript:void(0);" class="btn btn-secondary btn-block mb-4 mr-2">申请中</a>
                                <form method="POST">
                                    <input type="hidden" name="option" value="quit">
                                    <button class="btn btn-danger btn-block mb-4 mr-2">退出活动</button>
                                </form>

                                {% elif pStatus == "申请失败" %}
                                <a href="javascript:void(0);" class="btn btn-danger btn-block mb-4 mr-2">申请失败</a>

                                {% elif pStatus == "已报名" %}
                                <a href="javascript:void(0);" class="btn btn-primary btn-block mb-4 mr-2">已报名</a>
                                <form method="POST">
                                    <input type="hidden" name="option" value="quit">
                                    <button class="btn btn-danger btn-block mb-4 mr-2">退出活动</button>
                                </form>

                                {% elif pStatus == "已参与" %}
                                <a href="javascript:void(0);" class="btn btn-primary btn-block mb-4 mr-2">已参与</a>

                                {% elif pStatus == "未参与" %}
                                <a href="javascript:void(0);" class="btn btn-warning btn-block mb-4 mr-2">未参与</a>

                                {% elif pStatus == "放弃" %}
                                <a href="javascript:void(0);" class="btn btn-danger btn-block mb-4 mr-2">已退出</a>

                                {% endif %}
                                <!-- -------------------------- end check status --------------------------- -->

                                {% elif ownership %}

                                <!-- ------------------------- begin summary photo ------------------------- -->
                                {% if status == "已结束" %}
                                <button class="btn btn-success btn-block mb-4 mr-2" data-toggle="collapse"
                                    data-target="#summaryphoto">
                                    上传总结照片
                                </button>
                                <!--  如果要上传照片，则展示下面的部分  -->
                                <form method="POST" enctype="multipart/form-data">
                                    <div id="summaryphoto" class="collapse">
                                        <div class="form-group">
                                            <div class="col">
                                                <input onchange="showFilenameLocal(this.files)" type="file"
                                                    class="custom-file-input" id="images" name="images"
                                                    accept="image/*">
                                                <label id="upload_annouce_photo" name="upload_annouce_photo"
                                                    class="custom-file-label" for="customFile"> 请上传一张图片 </label>
                                            </div>
                                        </div>
                                        <input type="hidden" name="option" value="submitphoto">
                                        <button type="submit" class="btn btn-primary btn-block mb-4 mr-2">确认上传</button>
                                    </div>
                                </form>
                                <form method="POST">
                                    <input type="hidden" name="option" value="payment">
                                    <button class="btn btn-primary btn-block mb-4 mr-2">申请报销</button>
                                </form>
                                {% endif %}
                                <!-- -------------------------- end summary photo -------------------------- -->

                                <!-- --------------------------- begin settings ---------------------------- -->
                                {% if status == "审核中" or status == "报名中" or status == "等待中" %}
                                <form method="POST">
                                    <input type="hidden" name="option" value="edit">
                                    <button class="btn btn-primary btn-block mb-4 mr-2">修改信息</button>
                                </form>
                                <form method="POST">
                                    <input type="hidden" name="option" value="cancel">
                                    <button class="btn btn-danger btn-block mb-4 mr-2">取消活动</button>
                                </form>
                                {% endif %}
                                <!-- ---------------------------- end settings ----------------------------- -->

                                <!-- ----------------------------------------------------------------------- -->
                                <!--                             end person view                             -->
                                <!-- ----------------------------------------------------------------------- -->
                                {% endif %}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!--  END ACTIVITY INFORMATION  -->

        </div>

        <!--  BEGIN RELAVENT INFORMATION  -->
        <div class="col-md-3 col-sm-12 px-1">

            <!--  BEGIN INTRODUCTION  -->
            <div class="container w-100 px-0 layout-top-spacing">
                <div class="statbox widget box box-shadow">

                    <div class="widget-header">
                        <div class="row">
                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                <h4>详细介绍</h4>
                            </div>
                        </div>
                    </div>

                    <div class="widget-content widget-content-area">
                        <p class="ml-1">
                            {{ introduction }}
                        </p>
                    </div>

                </div>
            </div>
            <!--  END INTRODUCTION  -->

            {% if ownership and need_checkin %}
            <!--  BEGIN QR CODE  -->
            <div class="container w-100 px-0 layout-top-spacing">
                <div class="statbox widget box box-shadow">

                    <div class="widget-header">
                        <div class="row">
                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                <h4>签到二维码</h4>
                            </div>
                        </div>
                    </div>

                    <div class="widget-content widget-content-area">
                        <img class="d-block w-100" id="qrcode" src="{{ aQRcode }}" alt="check-in QR code">
                    </div>

                </div>
            </div>
            <!--  END QR CODE  -->
            {% endif %}

        </div>
        <!--  END RELAVENT INFORMATION  -->

    </div>
</div>

<script type="text/javascript">
    function showFilenameLocal(files) {
        var text = "";
        for (i = 0; i < files.length; i++) {
            text += (" " + files[i].name);
        }
        if (text == "")
            text = "请上传一张图片";
        $("#upload_annouce_photo").html(text);
    }
</script>

<!--  END CONTENT AREA  -->

{% endblock %}